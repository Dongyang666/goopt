#!/bin/sh

set -ev

make clean all install
cd example
make clean all
cd ..

example/example | grep BOO
example/example | grep 'name is anonymous'
example/example | grep 'I am unhappy'

example/example --undefined && exit 1
example/example -undef && exit 1

# We should fail given a nonexistent short argument
example/example -x && exit 1

example/example --sad | grep unhappy
example/example --happy | grep 'am happy'
# A unique prefix of a flag should work fine
example/example --ha | grep 'am happy'
# A non-unique prefix should exit with an error
example/example --h && exit 1

example/example -h | grep 'am happy'
example/example -u | grep 'am unhappy'
example/example -b boo | grep boo
example/example | grep 'very slow'
example/example --speed fast | grep 'very fast'
example/example --speed=fast
example/example --speed=fast | grep 'very fast'
example/example --velocity=medium | grep 'very medium'
example/example --velocity=mediu && exit 1

example/example --help | grep name=anonymous
example/example --help | grep ' -b BOO'
example/example --help | grep ' --unhappy, --sad'
example/example --help | grep '=.slow.medium.fast'

# Check that Strings works as expected:
example/example --word=hello | grep 'saying: hello'
example/example --word=hello --saying=world | grep 'saying: hello world'
example/example -ws hello world | grep 'saying: hello world'

# Check that Args works as expected
example/example pluto was a planet | grep "day, pluto was a planet$"

# Check that int works as expected
example/example -l 6 | egrep 'man\?{6}$'

echo all tests passed!
